
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IRM de diffusion &#8212; M√©thodes en neurosciences cognitives</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tomographie par √©mission de positrons" href="tep.html" />
    <link rel="prev" title="Connectivit√© fonctionnelle" href="connectivite.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">M√©thodes en neurosciences cognitives</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="cartes_cerebrales.html">
   Cartes c√©r√©brales
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irm.html">
   Imagerie par r√©sonance magn√©tique
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="morphometrie.html">
   Analyses morphom√©triques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irm_fonctionnelle.html">
   IRM fonctionnelle
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="connectivite.html">
   Connectivit√© fonctionnelle
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   IRM de diffusion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tep.html">
   Tomographie par √©mission de positrons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imagerie_optique.html">
   Imagerie optique
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cartes_statistiques.html">
   Cartes statistiques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reproductibilite.html">
   Reproductibilit√© et controverses
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/irm_diffusion.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/irm_diffusion.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/psy3018/notes_cours_psy3018/main?urlpath=tree/methodes_neurocog/irm_diffusion.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objectifs-du-cours">
   Objectifs du cours
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#principes-physiques-et-physiologiques">
   Principes physiques et physiologiques
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#diffusion-de-l-eau">
     Diffusion de l‚Äôeau
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#diffusion-isotrope-et-anisotrope">
     Diffusion isotrope et anisotrope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#diffusion-et-fibres-de-matiere-blanche">
     Diffusion et fibres de mati√®re blanche
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#acquisition-irmd">
     Acquisition IRMd
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tenseur-de-diffusion">
   Tenseur de diffusion
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#le-modele-du-tenseur">
     Le mod√®le du tenseur
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imagerie-par-tenseurs-de-diffusion">
     Imagerie par tenseurs de diffusion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caracteristiques-des-tenseurs">
     Caract√©ristiques des tenseurs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tractographie">
   Tractographie
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tractographie-streamline">
     Tractographie streamline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#croisement-de-fibres">
     Croisement de fibres
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#faisceaux-de-fibres">
     Faisceaux de fibres
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   R√©f√©rences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercices">
   Exercices
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="irm-de-diffusion">
<span id="irm-diffusion-chapitre"></span><h1>IRM de diffusion<a class="headerlink" href="#irm-de-diffusion" title="Permalink to this headline">¬∂</a></h1>
<table>
  <tr>
    <td align="center">
      <a href="https://github.com/me-pic">
        <img src="https://avatars.githubusercontent.com/u/77584086?v=4?s=100" width="100px;" alt=""/>
        <br /><sub><b>Marie-Eve Picard</b></sub>
      </a>
      <br />
        <a title="Contenu">ü§î</a>
        <a title="R√©vision du texte">üëÄ</a>
    </td>
    <td align="center">
      <a href="https://github.com/pbellec">
        <img src="https://avatars.githubusercontent.com/u/1670887?v=4?s=100" width="100px;" alt=""/>
        <br /><sub><b>Pierre bellec</b></sub>
      </a>
      <br />
        <a title="Contenu">ü§î</a>
        <a title="Exercices">‚ö†Ô∏è</a>
        <a title="R√©vision du texte">üëÄ</a>
    </td>
  </tr>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ce chapitre va √™tre mis √† jour √† l‚Äôautomne 2022. En particulier les exercices vont √™tre r√©vis√©s, et certains exercices pourraient √™tre ajout√©s ou supprim√©s.</p>
</div>
<div class="section" id="objectifs-du-cours">
<h2>Objectifs du cours<a class="headerlink" href="#objectifs-du-cours" title="Permalink to this headline">¬∂</a></h2>
<p>Ce cours a pour but de vous initier aux principes de l‚Äôimagerie par r√©sonance magn√©tique de diffusion (IRMd). L‚ÄôIRMd est une modalit√© de neuroimagerie qui nous permet d‚Äô√©tudier les <strong>fibres de mati√®re blanche</strong>. Nous allons donc pouvoir examiner les connexions entre diff√©rentes r√©gions, autant interh√©misph√©riques (i.e., fibres de mati√®re blanche voyageant d‚Äôun h√©misph√®re √† l‚Äôautre), qu‚Äôintrah√©misph√©riques (i.e., fibres de mati√®re blanche voyageant au sein d‚Äôun m√™me h√©misph√®re). Pour vous faire une id√©e concr√®te de ce √† quoi ressemblent les fibres de mati√®re blanche, vous pouvez regarder cette <a class="reference external" href="https://www.youtube.com/watch?v=PazaHElk6wc">vid√©o</a> pr√©sentant des dissections c√©r√©brales, tir√©e du <a class="reference external" href="http://www.neuroanatomy.ca/">cours de neuroanatomie fonctionnelle de UBC</a>.</p>
<p>Pendant ce cours, nous allons aborder :</p>
<ul class="simple">
<li><p>Les principes <strong>physiques</strong> et <strong>physiologiques</strong> du signal en IRMd.</p></li>
<li><p>Le mod√®le du <strong>tenseur de diffusion</strong>.</p></li>
<li><p>Les analyses de <strong>tractographie</strong>.</p></li>
</ul>
</div>
<div class="section" id="principes-physiques-et-physiologiques">
<h2>Principes physiques et physiologiques<a class="headerlink" href="#principes-physiques-et-physiologiques" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="diffusion-de-l-eau">
<h3>Diffusion de l‚Äôeau<a class="headerlink" href="#diffusion-de-l-eau" title="Permalink to this headline">¬∂</a></h3>
<div class="figure align-default" id="diffusion-water-fig">
<a class="reference internal image-reference" href="_images/diffusion-water.jpg"><img alt="_images/diffusion-water.jpg" src="_images/diffusion-water.jpg" style="width: 800px;" /></a>
<p class="caption"><span class="caption-number">Fig. 60 </span><span class="caption-text">Illustration de la diffusion d‚Äôune goutte d‚Äôencre dans un verre d‚Äôeau. Image par <a class="reference external" href="https://www.shutterstock.com/g/NARUDON+ATSAWALARPSAKUN">Narudon Atsawalarpsakun</a> disponible sur <a class="reference external" href="https://www.shutterstock.com/image-photo/blue-food-coloring-diffuse-water-inside-736860766">shutterstock</a> ID <code class="docutils literal notranslate"><span class="pre">736860766</span></code>, utilis√©e sous licence shutterstock standard.</span><a class="headerlink" href="#diffusion-water-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>En IRM de diffusion, nous nous int√©ressons √† la mani√®re dont l‚Äôeau diffuse dans le cerveau. En examinant comment l‚Äôeau se diffuse, nous pouvons apprendre des informations sur le milieu de diffusion, dans notre cas, le cerveau ! Plus pr√©cis√©ment, l‚ÄôIRMd nous permet d‚Äôen apprendre davantage sur les <strong>propri√©t√©s de la microstructure</strong> des fibres de mati√®re blanche. Pour un exemple concret de diffusion, nous pouvons imaginer ce qui se passe lorsque nous laissons tomber une goutte d‚Äôencre dans un verre d‚Äôeau, illustr√©e en <a class="reference internal" href="#diffusion-water-fig"><span class="std std-numref">Fig. 60</span></a>. L‚Äôencre va au cours du temps se diffuser dans l‚Äôeau, colorant l‚Äôeau petit √† petit, jusqu‚Äô√† ce qu‚Äôelle devienne color√©e de mani√®re homog√®ne. Les mol√©cules d‚Äôeau et d‚Äôencre entrent en collision dans des directions al√©atoires, et suivent un processus de marche al√©atoire appel√© <a class="reference external" href="https://fr.wikipedia.org/wiki/Mouvement_brownien">mouvement Brownien</a>, voir <a class="reference internal" href="#brownian-fig"><span class="std std-numref">Fig. 61</span></a>.</p>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Brownian motion</span>
<span class="sd">code adapted from Scipy Cookbook https://scipy-cookbook.readthedocs.io/items/BrownianMotion.html</span>
<span class="sd">under an MIT-like license https://github.com/scipy/scipy-cookbook/blob/master/LICENSE.txt</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">brownian</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an instance of Brownian motion (i.e. the Wiener process):</span>

<span class="sd">        X(t) = X(0) + N(0, delta**2 * t; 0, t)</span>

<span class="sd">    where N(a,b; t0, t1) is a normally distributed random variable with mean a and</span>
<span class="sd">    variance b.  The parameters t0 and t1 make explicit the statistical</span>
<span class="sd">    independence of N on different time intervals; that is, if [t0, t1) and</span>
<span class="sd">    [t2, t3) are disjoint intervals, then N(a, b; t0, t1) and N(a, b; t2, t3)</span>
<span class="sd">    are independent.</span>

<span class="sd">    Written as an iteration scheme,</span>

<span class="sd">        X(t + dt) = X(t) + N(0, delta**2 * dt; t, t+dt)</span>


<span class="sd">    If `x0` is an array (or array-like), each value in `x0` is treated as</span>
<span class="sd">    an initial condition, and the value returned is a numpy array with one</span>
<span class="sd">    more dimension than `x0`.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    x0 : float or numpy array (or something that can be converted to a numpy array</span>
<span class="sd">         using numpy.asarray(x0)).</span>
<span class="sd">        The initial condition(s) (i.e. position(s)) of the Brownian motion.</span>
<span class="sd">    n : int</span>
<span class="sd">        The number of steps to take.</span>
<span class="sd">    dt : float</span>
<span class="sd">        The time step.</span>
<span class="sd">    delta : float</span>
<span class="sd">        delta determines the &quot;speed&quot; of the Brownian motion.  The random variable</span>
<span class="sd">        of the position at time t, X(t), has a normal distribution whose mean is</span>
<span class="sd">        the position at time t=0 and whose variance is delta**2*t.</span>
<span class="sd">    out : numpy array or None</span>
<span class="sd">        If `out` is not None, it specifies the array in which to put the</span>
<span class="sd">        result.  If `out` is None, a new numpy array is created and returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A numpy array of floats with shape `x0.shape + (n,)`.</span>

<span class="sd">    Note that the initial value `x0` is not included in the returned array.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

    <span class="c1"># For each element of x0, generate a sample of n numbers from a</span>
    <span class="c1"># normal distribution.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x0</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="p">,))</span>
        <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">scale</span><span class="o">=</span><span class="n">delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
        <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">scale</span><span class="o">=</span><span class="n">delta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
        <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">scale</span><span class="o">=</span><span class="n">delta</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">x0</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">scale</span><span class="o">=</span><span class="n">delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>

    <span class="c1"># If `out` was not given, create an output array.</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># This computes the Brownian motion by forming the cumulative sum of</span>
    <span class="c1"># the random samples.</span>
    <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>

    <span class="c1"># Add the initial condition.</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="c1"># The Wiener process parameter.</span>
<span class="n">delta</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">]</span>
<span class="c1"># Total time.</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="c1"># Number of steps.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>
<span class="c1"># Time step size</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">N</span>
<span class="c1"># Initial values of x.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>
<span class="n">n_samp</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_samp</span><span class="p">))</span>
<span class="k">for</span> <span class="n">samp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samp</span><span class="p">):</span>
    <span class="n">brownian</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span>

    <span class="c1"># Plot the 2D trajectory.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">points</span><span class="p">[:,</span> <span class="n">samp</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Mark the start and end points.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">samp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samp</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">samp</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">samp</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># More plot decorations.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mouvement Brownien 2D&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X axis&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y axis&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;brownian-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="brownian-fig" style="width: 500px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_1_0.png" src="_images/irm_diffusion_1_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 61 </span><span class="caption-text">Illustration de mouvement Brownien d‚Äôune mol√©cule. Le point de d√©part est indiqu√© par un cercle rouge. Les trajectoires de couleurs correspondent √† des marches al√©atoires simul√©es suivant un mouvement Brownien. Les points bleus indiquent le point d‚Äôarriv√©e de chaque marche. Figure g√©n√©r√©e √† l‚Äôaide de code Python par P. Bellec, sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.  Le code de simulation de mouvement Brownien est adapt√© du <a class="reference external" href="https://scipy-cookbook.readthedocs.io/items/BrownianMotion.html">Scipy Cookbook</a> sous une <a class="reference external" href="https://github.com/scipy/scipy-cookbook/blob/master/LICENSE.txt">licence</a> proche de MIT.</span><a class="headerlink" href="#brownian-fig" title="Permalink to this image">¬∂</a></p>
</div>
</div>
<div class="section" id="diffusion-isotrope-et-anisotrope">
<h3>Diffusion isotrope et anisotrope<a class="headerlink" href="#diffusion-isotrope-et-anisotrope" title="Permalink to this headline">¬∂</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_speed</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
<span class="c1"># Initial values of x.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_speed</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_speed</span><span class="p">),</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">n_samp</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">delta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">speed</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_samp</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">samp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samp</span><span class="p">):</span>
        <span class="n">brownian</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">points</span><span class="p">[:,</span> <span class="n">samp</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">ax</span><span class="o">.</span><span class="n">get_zlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_zlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vitesse x = </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;anisotropic-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="anisotropic-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_3_0.png" src="_images/irm_diffusion_3_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 62 </span><span class="caption-text">Diffusion isotrope vs anisotrope. Chaque rond bleu repr√©sente le point d‚Äôarriv√©e d‚Äôune mol√©cule d‚Äôeau selon une simulation de marche al√©atoire avec un processus Brownien en 3D. Sur le graphe de gauche, la vitesse de diffusion des mol√©cules d‚Äôeau est identique dans toutes les directions. Sur les graphes du milieu et de droite, la vitesse de diffusion est sup√©rieure selon l‚Äôaxe <code class="docutils literal notranslate"><span class="pre">x</span></code> que selon <code class="docutils literal notranslate"><span class="pre">y</span></code> et <code class="docutils literal notranslate"><span class="pre">z</span></code>. Figure g√©n√©r√©e √† l‚Äôaide de code Python par P. Bellec, sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#anisotropic-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>Le d√©placement des mol√©cules d‚Äôeau dans un milieu suit un mouvement Brownien. Si le milieu a des caract√©ristiques similaires dans toutes les directions, on parle de milieu <strong>isotrope</strong>. Le graphe de gauche de la <a class="reference internal" href="#anisotropic-fig"><span class="std std-numref">Fig. 62</span></a> repr√©sente l‚Äôensemble des points d‚Äôarriv√©e de marches al√©atoires dans un tel milieu isotrope. On remarque que les mol√©cules se r√©partissent approximativement dans une sph√®re. Que se passe-t-il si la diffusion est plus rapide dans une direction donn√©e, par exemple l‚Äôaxe <code class="docutils literal notranslate"><span class="pre">x</span></code>? On parle alors de milieu <strong>anisotrope</strong>. Sur le graphe du milieu, on voit que la forme remplie par les mol√©cules s‚Äôallonge, et ressemble plus √† un ballon de football am√©ricain qu‚Äô√† une sph√®re (ou, en termes math√©matiques, une ellipse). Plus la diff√©rence de vitesse de diffusion sur <code class="docutils literal notranslate"><span class="pre">x</span></code> grandit par rapport aux directions <code class="docutils literal notranslate"><span class="pre">y</span></code> et <code class="docutils literal notranslate"><span class="pre">z</span></code>, et plus la forme s‚Äôallonge (graphe de droite).</p>
</div>
<div class="section" id="diffusion-et-fibres-de-matiere-blanche">
<h3>Diffusion et fibres de mati√®re blanche<a class="headerlink" href="#diffusion-et-fibres-de-matiere-blanche" title="Permalink to this headline">¬∂</a></h3>
<div class="figure align-default" id="dissection-fig">
<a class="reference internal image-reference" href="_images/dissection.png"><img alt="_images/dissection.png" src="_images/dissection.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-number">Fig. 63 </span><span class="caption-text">Dissection c√©r√©brale illustrant l‚Äôorganisation de la mati√®re blanche c√©r√©brale en faisceaux de fibres. Bas droite: sch√©ma illustrant la diffusion de l‚Äôeau contrainte par les fibres. Le point rouge correspond √† l‚Äôorigine de marches al√©atoires, dont les terminaisons sont indiqu√©es par les points bleus. Images de cerveau tir√©es de <span id="id1">[<a class="reference internal" href="#id33">BFH+20</a>]</span>, sous licence CC-BY 4.0. Le reste de la figure par P Bellec, sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>, inspir√©e par la th√®se de C. Poupon, 1999.</span><a class="headerlink" href="#dissection-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>Les axones des neurones viennent contraindre la diffusion de l‚Äôeau, les mol√©cules d‚Äôeau ne peuvent donc pas se d√©placer librement dans toutes les directions. Le profil de diffusion des mol√©cules d‚Äôeau suit alors une forme anisotrope, comme on vient de le voir en <a class="reference internal" href="#anisotropic-fig"><span class="std std-numref">Fig. 62</span></a>. L‚Äôeau diffuse plus facilement dans la direction parall√®le aux fibres. La diffusion est donc anisotrope et le coefficient de diffusion sera alors plus √©lev√© dans cette direction parall√®le, voir <a class="reference internal" href="#dissection-fig"><span class="std std-numref">Fig. 63</span></a>.
Alors, en sachant comment diffuse l‚Äôeau, nous pouvons d√©terminer la configuration des axones. Le ph√©nom√®ne de diffusion d√©pend de la structure du tissu! C‚Äôest le principe physiologique √† l‚Äôorigine des mesures en IRMd.</p>
</div>
<div class="section" id="acquisition-irmd">
<h3>Acquisition IRMd<a class="headerlink" href="#acquisition-irmd" title="Permalink to this headline">¬∂</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">get_fnames</span>
<span class="kn">from</span> <span class="nn">dipy.io.image</span> <span class="kn">import</span> <span class="n">load_nifti</span><span class="p">,</span> <span class="n">save_nifti</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">hardi_fname</span><span class="p">,</span> <span class="n">hardi_bval_fname</span><span class="p">,</span> <span class="n">hardi_bvec_fname</span> <span class="o">=</span> <span class="n">get_fnames</span><span class="p">(</span><span class="s1">&#39;stanford_hardi&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">,</span> <span class="n">affine</span> <span class="o">=</span> <span class="n">load_nifti</span><span class="p">(</span><span class="n">hardi_fname</span><span class="p">)</span>

<span class="n">sli</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">list_vol</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>  <span class="c1"># pick out random volumes and gradient directions</span>

<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xticks&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;yticks&#39;</span><span class="p">:</span> <span class="p">[]})</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">vol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_vol</span><span class="p">):</span>
    <span class="n">vol_slice</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">sli</span><span class="p">,</span> <span class="n">vol</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vol_slice</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                  <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;direction </span><span class="si">{</span><span class="n">num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;diffusion-direction-fig&quot;</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="diffusion-direction-fig" style="width: 600px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_5_0.png" src="_images/irm_diffusion_5_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 64 </span><span class="caption-text">Volumes IRM pond√©r√©es en diffusion. Chaque coupe axiale repr√©sente un volume T2* pond√©r√©e en diffusion pour une direction diff√©rente. Figure g√©n√©r√©e √† l‚Äôaide de code Python par P. Bellec, sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>. Le code est adapt√© d‚Äôun <a class="reference external" href="https://dipy.org/documentation/1.4.1./examples_built/denoise_patch2self/#example-denoise-patch2self">tutorial</a> de la librairie <a class="reference external" href="https://dipy.org/">Dipy</a>, distribu√©e sous licence <a class="reference external" href="https://github.com/dipy/dipy/blob/master/LICENSE">BSD 3-Clause</a>.</span><a class="headerlink" href="#diffusion-direction-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>En IRM de diffusion, nous allons prendre des images selon plusieurs orientations. Ce sont des images pond√©r√©es en T2* que nous acqu√©rons en IRMd. La s√©quence appliqu√©e rend l‚Äôimage sensible √† la diffusion de l‚Äôeau, dans une direction donn√©e. Pour un voxel donn√©, nous allons prendre des mesures dans diff√©rentes directions, qui vont nous dire si l‚Äôeau a beaucoup diffus√©e dans cette direction l√†, un peu comme les points bleus de la <a class="reference internal" href="#dissection-fig"><span class="std std-numref">Fig. 63</span></a>. Pour un volume IRMd, la valeur en un voxel nous dit si le point bleu est loin ou pas du point rouge, pour une direction que l‚Äôon a s√©lectionn√©e, voir <a class="reference internal" href="#diffusion-direction-fig"><span class="std std-numref">Fig. 64</span></a></p>
</div>
</div>
<div class="section" id="tenseur-de-diffusion">
<h2>Tenseur de diffusion<a class="headerlink" href="#tenseur-de-diffusion" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="le-modele-du-tenseur">
<h3>Le mod√®le du tenseur<a class="headerlink" href="#le-modele-du-tenseur" title="Permalink to this headline">¬∂</a></h3>
<div class="figure align-default" id="tensor-schematic-fig">
<a class="reference internal image-reference" href="_images/tensor-schematic.png"><img alt="_images/tensor-schematic.png" src="_images/tensor-schematic.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 65 </span><span class="caption-text">La diffusion des mol√©cules d‚Äôeau au cours du temps peut se visualiser comme un nuage de points. √Ä cause des contraintes de l‚Äôenvironnement, notamment les axones, ce nuage prend la forme d‚Äôun ballon de rugby (haut, gauche). La forme du nuage peut √™tre approxim√©e avec un mod√®le de tenseur (bas √† gauche). Les param√®tres principaux de ce mod√®le sont les directions principales de diffusion <span class="math notranslate nohighlight">\(e_1\)</span>, <span class="math notranslate nohighlight">\(e_2\)</span>, <span class="math notranslate nohighlight">\(e_3\)</span>, ainsi que les valeurs de diffusion associ√©es √† ces directions <span class="math notranslate nohighlight">\(\lambda_1 \geq \lambda_2 \geq \lambda_3\)</span>. Figure par P. Bellec sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>, inspir√©e par M. Descoteaux et C. Poupon,</span><a class="headerlink" href="#tensor-schematic-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>√Ä partir des simulations ci-dessus, il est intuitif d‚Äôimaginer la diffusion de l‚Äôeau comme un ballon, plus ou moins allong√©. Math√©matiquement, cela se formule avec un tenseur de diffusion, ou <strong>mod√®le Gaussien</strong>, voir <a class="reference internal" href="#tensor-schematic-fig"><span class="std std-numref">Fig. 65</span></a>. Pour estimer la forme de notre ballon dans chaque voxel, nous utilisons les diff√©rentes valeurs de diffusion obtenues pour chaque direction d‚Äôacquistion. Si la diffusion est plus grande selon une certaine direction, notre ballon ressemblera plut√¥t √† un ballon de rugby. Si la diffusion est semblable dans toutes les directions d‚Äôacquisition, nous obtiendrons plut√¥t un ballon de soccer.</p>
</div>
<div class="section" id="imagerie-par-tenseurs-de-diffusion">
<h3>Imagerie par tenseurs de diffusion<a class="headerlink" href="#imagerie-par-tenseurs-de-diffusion" title="Permalink to this headline">¬∂</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import des modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dipy.io.image</span> <span class="kn">import</span> <span class="n">load_nifti</span><span class="p">,</span> <span class="n">save_nifti</span>
<span class="kn">from</span> <span class="nn">dipy.io.gradients</span> <span class="kn">import</span> <span class="n">read_bvals_bvecs</span>
<span class="kn">from</span> <span class="nn">dipy.core.gradients</span> <span class="kn">import</span> <span class="n">gradient_table</span>
<span class="kn">import</span> <span class="nn">dipy.reconst.dti</span> <span class="k">as</span> <span class="nn">dti</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">get_fnames</span>

<span class="c1"># Select patch</span>
<span class="n">minx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">maxx</span> <span class="o">=</span> <span class="mi">81</span>
<span class="n">miny</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">maxy</span> <span class="o">=</span> <span class="mi">106</span>
<span class="n">minz</span> <span class="o">=</span> <span class="mi">28</span>
<span class="n">maxz</span> <span class="o">=</span> <span class="mi">32</span>

<span class="c1"># T√©l√©charge des donn√©es HARDI</span>
<span class="n">hardi_fname</span><span class="p">,</span> <span class="n">hardi_bval_fname</span><span class="p">,</span> <span class="n">hardi_bvec_fname</span> <span class="o">=</span> <span class="n">get_fnames</span><span class="p">(</span><span class="s1">&#39;stanford_hardi&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">,</span> <span class="n">affine</span> <span class="o">=</span> <span class="n">load_nifti</span><span class="p">(</span><span class="n">hardi_fname</span><span class="p">)</span>
<span class="n">bvals</span><span class="p">,</span> <span class="n">bvecs</span> <span class="o">=</span> <span class="n">read_bvals_bvecs</span><span class="p">(</span><span class="n">hardi_bval_fname</span><span class="p">,</span> <span class="n">hardi_bvec_fname</span><span class="p">)</span>
<span class="n">gtab</span> <span class="o">=</span> <span class="n">gradient_table</span><span class="p">(</span><span class="n">bvals</span><span class="p">,</span> <span class="n">bvecs</span><span class="p">)</span>

<span class="c1"># Force affine to something simple to make it easier to extract patches</span>
<span class="n">affine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Masque les donn√©es et estime les tenseurs</span>
<span class="kn">from</span> <span class="nn">dipy.segment.mask</span> <span class="kn">import</span> <span class="n">median_otsu</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">minz</span><span class="p">:</span><span class="n">maxz</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">maskdata</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">median_otsu</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vol_idx</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">median_radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">numpass</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">autocrop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dilate</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tenmodel</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">TensorModel</span><span class="p">(</span><span class="n">gtab</span><span class="p">)</span>
<span class="n">tenfit</span> <span class="o">=</span> <span class="n">tenmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maskdata</span><span class="p">)</span>

<span class="c1"># G√©n√®re m√©triques d√©riv√©es (FA etc)</span>
<span class="kn">from</span> <span class="nn">dipy.reconst.dti</span> <span class="kn">import</span> <span class="n">fractional_anisotropy</span><span class="p">,</span> <span class="n">color_fa</span>
<span class="n">FA</span> <span class="o">=</span> <span class="n">fractional_anisotropy</span><span class="p">(</span><span class="n">tenfit</span><span class="o">.</span><span class="n">evals</span><span class="p">)</span>
<span class="n">FA</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">FA</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">FA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">FA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">RGB</span> <span class="o">=</span> <span class="n">color_fa</span><span class="p">(</span><span class="n">FA</span><span class="p">,</span> <span class="n">tenfit</span><span class="o">.</span><span class="n">evecs</span><span class="p">)</span>
<span class="n">MD1</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">mean_diffusivity</span><span class="p">(</span><span class="n">tenfit</span><span class="o">.</span><span class="n">evals</span><span class="p">)</span>

<span class="c1"># Figure</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">get_sphere</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">get_sphere</span><span class="p">(</span><span class="s1">&#39;repulsion724&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="kn">import</span> <span class="n">window</span><span class="p">,</span> <span class="n">actor</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">evals</span> <span class="o">=</span> <span class="n">tenfit</span><span class="o">.</span><span class="n">evals</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">evecs</span> <span class="o">=</span> <span class="n">tenfit</span><span class="o">.</span><span class="n">evecs</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:]</span>

<span class="c1"># boost the colors</span>
<span class="n">RGB</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">RGB</span><span class="p">[</span><span class="n">RGB</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">cfa</span> <span class="o">=</span> <span class="n">RGB</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">tensor_slicer</span><span class="p">(</span><span class="n">evals</span><span class="p">,</span> <span class="n">evecs</span><span class="p">,</span> <span class="n">scalar_colors</span><span class="o">=</span><span class="n">cfa</span><span class="p">,</span> <span class="n">sphere</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span>
                              <span class="n">scale</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">14.87946710578175</span><span class="p">,</span> <span class="mf">25.770232149765413</span><span class="p">,</span> <span class="mf">173.54578028650144</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">33.43851200470716</span><span class="p">,</span> <span class="mf">40.67356830562871</span><span class="p">,</span> <span class="mf">15.545914873824975</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.003256400517440014</span><span class="p">,</span> <span class="mf">0.9955397521536979</span><span class="p">,</span> <span class="mf">0.09428678453221151</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;tensor-slice.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">6.398539759431944</span><span class="p">,</span> <span class="mf">36.122368120824724</span><span class="p">,</span> <span class="mf">21.074961978614017</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">17.02336666201742</span><span class="p">,</span> <span class="mf">55.39317316617157</span><span class="p">,</span> <span class="mf">7.230217513090364</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.10205867972271891</span><span class="p">,</span> <span class="mf">0.5426923506538308</span><span class="p">,</span> <span class="mf">0.8337080055001721</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;tensor-zoom.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>             

<span class="c1"># Make figure</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xticks&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;yticks&#39;</span><span class="p">:</span> <span class="p">[]})</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;tensor-slice.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;antialiased&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;full slice&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;tensor-zoom.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">)</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;tensor-fig&quot;</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="tensor-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_7_1.png" src="_images/irm_diffusion_7_1.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 66 </span><span class="caption-text">Tenseurs de diffusion estim√©s sur une coupe axiale (gauche) et zoom sur une portion de la coupe (droite). La couleur de chaque tenseur code pour la direction principale de diffusion, ainsi que l‚Äôanisotropie fractionnelle de chaque tenseur. Les tenseurs les plus brillants sont fortement anisotropes, c‚Äôest-√†-dire que la direction principale de diffusion est nettement plus forte que les directions transverses. Figure g√©n√©r√©e par du code python adapt√© d‚Äôun <a class="reference external" href="https://dipy.org/documentation/1.4.1./examples_built/reconst_dti/#example-reconst-dti">tutoriel Dipy</a> par P. Bellec sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#tensor-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>L‚Äôimagerie par tenseurs de diffusion (<em>diffusion tensor imaging</em>, DTI) est l‚Äôune des premi√®res techniques d‚Äôanalyse qui a vu le jour en IRM de diffusion. Pour estimer la forme de notre ballon, nous avons besoin d‚Äôau moins six directions d‚Äôacquisition: <code class="docutils literal notranslate"><span class="pre">xy</span></code>, <code class="docutils literal notranslate"><span class="pre">xz</span></code>, <code class="docutils literal notranslate"><span class="pre">yz</span></code>, <code class="docutils literal notranslate"><span class="pre">-xy</span></code>, <code class="docutils literal notranslate"><span class="pre">-xz</span></code>, <code class="docutils literal notranslate"><span class="pre">y-z</span></code>. C‚Äôest en combinant les images dans ces six directions que nous pouvons estimer notre tenseur de diffusion (notre ballon). Comme nous avons ces mesures pour chacun des voxels, nous pouvons cr√©er un volume c√©r√©bral o√π la valeur de chaque voxel est un tenseur (ballon), voir <a class="reference internal" href="#tensor-fig"><span class="std std-numref">Fig. 66</span></a>.</p>
</div>
<div class="section" id="caracteristiques-des-tenseurs">
<h3>Caract√©ristiques des tenseurs<a class="headerlink" href="#caracteristiques-des-tenseurs" title="Permalink to this headline">¬∂</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">RGB2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">RGB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">RGB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">RGB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
<span class="n">MD</span> <span class="o">=</span> <span class="n">MD1</span>
<span class="n">MD</span><span class="p">[</span><span class="n">mask</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">RGB2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">RGB</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xticks&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;yticks&#39;</span><span class="p">:</span> <span class="p">[]})</span>

<span class="n">fig1</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">FA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;carte de FA&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">MD</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;carte de MD&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">RGB2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;direction principale&#39;</span><span class="p">)</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;fa-md-rgb-fig&quot;</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="fa-md-rgb-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_9_0.png" src="_images/irm_diffusion_9_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 67 </span><span class="caption-text">Cartes d√©riv√©es de tenseurs en IRM de diffusion: anisotropie fractionnelle (gauche), diffusivit√© moyenne (milieu) et direction principale du tenseur (droite). Pour la direction principale, l‚Äôaxe m√©dial-lat√©ral (<code class="docutils literal notranslate"><span class="pre">x</span></code>) est cod√© en rouge, l‚Äôaxe ant√©rieur-post√©rieur (<code class="docutils literal notranslate"><span class="pre">y</span></code>) est cod√© en vert, et l‚Äôaxe ventral-dorsal (<code class="docutils literal notranslate"><span class="pre">z</span></code>) est cod√© en bleu. Figure g√©n√©r√©e √† l‚Äôaide de code Python adapt√© d‚Äôun <a class="reference external" href="https://dipy.org/documentation/1.4.1./examples_built/reconst_fwdti/#example-reconst-fwdti">tutoriel Dipy</a> par P. Bellec, sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#fa-md-rgb-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>Il est possible de r√©sumer certaines caract√©ristiques importantes des tenseurs de diffusion √† l‚Äôaide d‚Äôune unique mesure, comme l‚Äôanisotropie fractionnelle et la diffusivit√© moyenne (voir d√©finitions ci-dessous). On extrait donc une mesure par voxel, ce qui peut se repr√©senter avec une carte c√©r√©brale, de mani√®re similaire √† ce que l‚Äôon a vu avec les images pond√©r√©es en T1 ou en T2, voir <a class="reference internal" href="#fa-md-rgb-fig"><span class="std std-numref">Fig. 67</span></a>. Il est aussi possible de cr√©er une image en couleurs, qui code pour la direction principale de diffusion.</p>
<div class="admonition-anisotropie-fractionnelle admonition">
<p class="admonition-title">Anisotropie fractionnelle</p>
<p>Une mesure populaire est l‚Äô<a class="reference external" href="https://en.wikipedia.org/wiki/Fractional_anisotropy">anisotropie fractionnelle</a> (FA en anglais), qui permet de mesurer le degr√© d‚Äôanisotropie d‚Äôun ph√©nom√®ne de diffusion, en prenant des valeurs entre 0 et 1. Une valeur d‚Äôanisotropie fractionnelle de 0 indique une diffusion isotropique (ballon de soccer), alors qu‚Äôune valeur de 1 indique une diffusion fortement anisotropie (ballon de rugby). √Ä noter que l‚Äôanisotropie fractionnelle de l‚Äôeau est 0, √† moins que la diffusion soit contrainte par une structure. Les valeurs fortes de FA se retrouvent g√©n√©ralement dans la mati√®re blanche.</p>
</div>
<div class="admonition-diffusivite-moyenne admonition">
<p class="admonition-title">Diffusivit√© moyenne</p>
<p>Nous pouvons aussi mesurer la <strong>diffusivit√© moyenne</strong> selon l‚Äô√©quation suivante (voir <a class="reference internal" href="#tensor-schematic-fig"><span class="std std-numref">Fig. 65</span></a> pour les notations):
<span class="math notranslate nohighlight">\(\overline{\lambda} = \frac{\lambda_{1}+\lambda_{2}+\lambda_{3}}{3}\)</span>
La diffusivit√© moyenne nous indique √† quel point il y a de la diffusion √† l‚Äôint√©rieur d‚Äôun voxel. La diffusivit√© moyenne est tr√®s forte dans le liquide c√©phalo-rachidien, o√π les mol√©cules d‚Äôeau sont tr√®s peu contraintes.</p>
</div>
<div class="admonition-direction-principale-de-diffusion admonition">
<p class="admonition-title">Direction principale de diffusion</p>
<p>Afin de visualiser dans quelle direction principale pointe les tenseurs, une approche populaire consiste √† coder chaque axe <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> et <code class="docutils literal notranslate"><span class="pre">z</span></code> avec une couleur (rouge, vert, bleu, respectivement). Pour une direction donn√©e, on m√©lange les trois couleurs dans une proportion correspondant aux contributions des trois axes.</p>
</div>
</div>
</div>
<div class="section" id="tractographie">
<h2>Tractographie<a class="headerlink" href="#tractographie" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="tractographie-streamline">
<h3>Tractographie streamline<a class="headerlink" href="#tractographie-streamline" title="Permalink to this headline">¬∂</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">MD</span> <span class="o">=</span> <span class="n">MD1</span>
<span class="n">MD</span><span class="p">[</span><span class="n">mask</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">threshold_fa</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">mask_wm</span> <span class="o">=</span> <span class="n">FA</span> <span class="o">&gt;</span> <span class="n">threshold_fa</span>


<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xticks&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;yticks&#39;</span><span class="p">:</span> <span class="p">[]})</span>

<span class="n">fig1</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">FA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;carte d</span><span class="se">\&#39;</span><span class="s1">anisotropie fractionnelle&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">mask_wm</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;masque de la mati√®re blanche&#39;</span><span class="p">)</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;mask-wm-fig&quot;</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dipy.tracking</span> <span class="kn">import</span> <span class="n">utils</span>

<span class="n">seeds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">seeds_from_mask</span><span class="p">(</span><span class="n">mask_wm</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">affine</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="kn">from</span> <span class="nn">dipy.tracking.stopping_criterion</span> <span class="kn">import</span> <span class="n">ThresholdStoppingCriterion</span>

<span class="n">stopping_criterion</span> <span class="o">=</span> <span class="n">ThresholdStoppingCriterion</span><span class="p">(</span><span class="n">FA</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">dipy.direction</span> <span class="kn">import</span> <span class="n">peaks_from_model</span>
<span class="n">csa_peaks</span> <span class="o">=</span> <span class="n">peaks_from_model</span><span class="p">(</span><span class="n">tenmodel</span><span class="p">,</span> <span class="n">maskdata</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">sphere</span><span class="p">,</span>
                             <span class="n">relative_peak_threshold</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span>
                             <span class="n">min_separation_angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
                             <span class="n">mask</span><span class="o">=</span><span class="n">mask_wm</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:])</span>

<span class="kn">from</span> <span class="nn">dipy.tracking.local_tracking</span> <span class="kn">import</span> <span class="n">LocalTracking</span>
<span class="kn">from</span> <span class="nn">dipy.tracking.streamline</span> <span class="kn">import</span> <span class="n">Streamlines</span>

<span class="c1"># Initialization of LocalTracking. The computation happens in the next step.</span>
<span class="n">streamlines_generator</span> <span class="o">=</span> <span class="n">LocalTracking</span><span class="p">(</span><span class="n">csa_peaks</span><span class="p">,</span> <span class="n">stopping_criterion</span><span class="p">,</span> <span class="n">seeds</span><span class="p">,</span>
                                      <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">max_cross</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Generate streamlines object</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">Streamlines</span><span class="p">(</span><span class="n">streamlines_generator</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="kn">import</span> <span class="n">colormap</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">line_colors</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>
<span class="n">streamlines_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span>
                               <span class="n">colormap</span><span class="o">.</span><span class="n">line_colors</span><span class="p">(</span><span class="n">streamlines</span><span class="p">))</span>

<span class="c1"># Create the 3D display.</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">streamlines_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">tensor_slicer</span><span class="p">(</span><span class="n">evals</span><span class="p">,</span> <span class="n">evecs</span><span class="p">,</span> <span class="n">scalar_colors</span><span class="o">=</span><span class="n">cfa</span><span class="p">,</span> <span class="n">sphere</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span>
                              <span class="n">scale</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">14.87946710578175</span><span class="p">,</span> <span class="mf">25.770232149765413</span><span class="p">,</span> <span class="mf">173.54578028650144</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">33.43851200470716</span><span class="p">,</span> <span class="mf">40.67356830562871</span><span class="p">,</span> <span class="mf">15.545914873824975</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.003256400517440014</span><span class="p">,</span> <span class="mf">0.9955397521536979</span><span class="p">,</span> <span class="mf">0.09428678453221151</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;irm_diffusion/fibers-slice.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">6.398539759431944</span><span class="p">,</span> <span class="mf">36.122368120824724</span><span class="p">,</span> <span class="mf">21.074961978614017</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">17.02336666201742</span><span class="p">,</span> <span class="mf">55.39317316617157</span><span class="p">,</span> <span class="mf">7.230217513090364</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.10205867972271891</span><span class="p">,</span> <span class="mf">0.5426923506538308</span><span class="p">,</span> <span class="mf">0.8337080055001721</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;irm_diffusion/fibers-zoom.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Make figure</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xticks&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;yticks&#39;</span><span class="p">:</span> <span class="p">[]})</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;irm_diffusion/fibers-slice.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;antialiased&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;full slice&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;irm_diffusion/fibers-zoom.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;antialiased&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">)</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;fibers-fig&quot;</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="fibers-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_12_0.png" src="_images/irm_diffusion_12_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 68 </span><span class="caption-text">Fibres reconstruites par une approche streamline d√©terministe, qui consiste √† tracer une fibre en suivant la direction principale de chaque tenseur de mani√®re it√©rative, √† partir de l‚Äôensemble des points dans la mati√®re blanche sur une coupe axiale (gauche) et zoom sur une portion de la coupe (droite). La couleur de chaque fibre code pour la direction principale de diffusion le long de la fibre. Figure g√©n√©r√©e par du code python adapt√© d‚Äôun <a class="reference external" href="https://dipy.org/documentation/1.4.1./examples_built/tracking_introduction_eudx/#example-tracking-introduction-eudx">tutoriel Dipy</a> par P. Bellec sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#fibers-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>La <a class="reference external" href="https://fr.wikipedia.org/wiki/Tractographie">tractographie</a> permet de tracer le chemin des fibres de mati√®re blanche in vivo. Il existe plusieurs approches de tractographie. La tractographie <em>streamline</em> d√©terministe permet de reconstruire les fibres de mati√®re blanche en partant d‚Äôun point donn√© dans la mati√®re grise et en se d√©pla√ßant de mani√®re it√©rative selon la direction principale de diffusion. Le chemin va se terminer lorsque nous arrivons dans la mati√®re grise. Ce chemin va √™tre trac√© gr√¢ce √† un logiciel. La tractographie probabilitste est similaire √† la tractographie d√©terministe, mais consid√®re en plus une incertitude sur la direction des fibres de mati√®re blanche. Donc au lieu de reconstruire une seule fibre associ√©e √† un point de la mati√®re blanche, la tractographie probabiliste va en reconstruire plusieurs qui seront toutes l√©g√®rement diff√©rentes.</p>
<div class="admonition-etapes-de-pretraitement admonition">
<p class="admonition-title">√âtapes de pr√©traitement</p>
<p>Tout comme l‚ÄôIRMf des √©tapes de recalage et de d√©bruitage sont n√©cessaires pour pr√©parer les donn√©es avant d‚Äôestimer les tenseurs et effectuer la tractographie. De nombreux param√®tres sont √† s√©lectionner pour la tractographie elle-m√™me, qui peuvent influencer les r√©sultats. Il est aussi n√©cessaire de s√©lectionner un masque de la mati√®re blanche qui contient les points de d√©part pour la reconstruction de fibres, obtenu ici par seuillage d‚Äôune carte de FA.</p>
<div class="figure align-default" id="mask-wm-fig" style="width: 500px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_11_0.png" src="_images/irm_diffusion_11_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 69 </span><span class="caption-text">Carte d‚Äôanisotropite fractionnelle (gauche) et masque de la mati√®re blanche obtenue par seuillage (droite). Figure g√©n√©r√©e par du code python adapt√© d‚Äôun <a class="reference external" href="https://dipy.org/documentation/1.4.1./examples_built/tracking_introduction_eudx/#example-tracking-introduction-eudx">tutoriel Dipy</a> par P. Bellec sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#mask-wm-fig" title="Permalink to this image">¬∂</a></p>
</div>
</div>
</div>
<div class="section" id="croisement-de-fibres">
<h3>Croisement de fibres<a class="headerlink" href="#croisement-de-fibres" title="Permalink to this headline">¬∂</a></h3>
<div class="figure align-default" id="crossing-fibers">
<a class="reference internal image-reference" href="_images/crossing-fibers.png"><img alt="_images/crossing-fibers.png" src="_images/crossing-fibers.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-number">Fig. 70 </span><span class="caption-text">Illustration du probl√®me de croisement de fibres, illustr√© √† gauche. La diffusion de l‚Äôeau dans chaque fibre est associ√©e √† un tenseur qui pointe dans une direction diff√©rente (milieu). Lorsqu‚Äôon essaye d‚Äôapproximer la diffusion dans le croisement avec un seul tenseur, on observe un tenseur isotrope (droite). Figure par P Bellec, sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>, inspir√© par la th√®se de C. Poupon, 1999.</span><a class="headerlink" href="#crossing-fibers" title="Permalink to this image">¬∂</a></p>
</div>
<p>Une limitation que nous rencontrons avec l‚Äôimagerie en tenseur de diffusion est le croisement de fibres. Il est tr√®s courant dans la mati√®re blanche d‚Äôavoir plusieurs faisceaux de fibres qui se croisent. Lorsque  beaucoup de fibres se croisent comme dans la figure ci-dessous, le tenseur de diffusion apparait isotrope, m√™me s‚Äôil y a effectivement des fibres pr√©sentes dans le voxel. Dans ce cas, l‚Äôalgorithme de reconstruction de fibres ne saura pas quelle direction suivre. Une des technique utilis√©e pour r√©soudre ce probl√®me est l‚Äô<strong>imagerie de diffusion √† haute r√©solution</strong>, qui nous permet d‚Äôestimer plusieurs tenseurs pour un m√™me voxel. Cette technique consiste √† effectuer l‚Äôacquisition des donn√©es sur de nombreuses directions (une trentaine √† une soixantaine de directions) en utilisant une <strong>s√©quence HARDI</strong> (<em>High Angular Resolution Diffusion Imaging</em>). Les acquisitions r√©alis√©es avec cette s√©quence sont plus longues que celles en DTI, 5-30 min vs 3-4 min.</p>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">dipy.reconst.csdeconv</span> <span class="kn">import</span> <span class="n">auto_response_ssst</span>
<span class="kn">from</span> <span class="nn">dipy.reconst.csdeconv</span> <span class="kn">import</span> <span class="n">ConstrainedSphericalDeconvModel</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">default_sphere</span>
<span class="n">response</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">auto_response_ssst</span><span class="p">(</span><span class="n">gtab</span><span class="p">,</span> <span class="n">maskdata</span><span class="p">,</span> <span class="n">roi_radii</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fa_thr</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">csd_model</span> <span class="o">=</span> <span class="n">ConstrainedSphericalDeconvModel</span><span class="p">(</span><span class="n">gtab</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
<span class="n">csd_fit</span> <span class="o">=</span> <span class="n">csd_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maskdata</span><span class="p">)</span>
<span class="n">csd_odf</span> <span class="o">=</span> <span class="n">csd_fit</span><span class="o">.</span><span class="n">odf</span><span class="p">(</span><span class="n">default_sphere</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">dipy.data</span> <span class="kn">import</span> <span class="n">default_sphere</span>
<span class="n">fodf_spheres</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">odf_slicer</span><span class="p">(</span><span class="n">csd_odf</span><span class="p">,</span> <span class="n">sphere</span><span class="o">=</span><span class="n">default_sphere</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>

<span class="c1"># Create the 3D display.</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fodf_spheres</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">14.87946710578175</span><span class="p">,</span> <span class="mf">25.770232149765413</span><span class="p">,</span> <span class="mf">173.54578028650144</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">33.43851200470716</span><span class="p">,</span> <span class="mf">40.67356830562871</span><span class="p">,</span> <span class="mf">15.545914873824975</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.003256400517440014</span><span class="p">,</span> <span class="mf">0.9955397521536979</span><span class="p">,</span> <span class="mf">0.09428678453221151</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;irm_diffusion/fodf-slice.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">6.398539759431944</span><span class="p">,</span> <span class="mf">36.122368120824724</span><span class="p">,</span> <span class="mf">21.074961978614017</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">17.02336666201742</span><span class="p">,</span> <span class="mf">55.39317316617157</span><span class="p">,</span> <span class="mf">7.230217513090364</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.10205867972271891</span><span class="p">,</span> <span class="mf">0.5426923506538308</span><span class="p">,</span> <span class="mf">0.8337080055001721</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;irm_diffusion/fodf-zoom.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>   

<span class="c1"># Make figure</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xticks&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;yticks&#39;</span><span class="p">:</span> <span class="p">[]})</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;irm_diffusion/fodf-slice.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;antialiased&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;full slice&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;irm_diffusion/fodf-zoom.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">)</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;fodf-fig&quot;</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="fodf-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_14_0.png" src="_images/irm_diffusion_14_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 71 </span><span class="caption-text">Estimation de fODF sur une coupe axiale (gauche) et zoom sur une portion de la coupe (droite). Figure g√©n√©r√©e par du code python adapt√© d‚Äôun <a class="reference external" href="https://dipy.org/documentation/1.4.1./examples_built/reconst_csd/#example-reconst-csd">tutoriel Dipy</a> par P. Bellec sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#fodf-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>Avec une s√©quence HARDI, nous pouvons estimer une fonction de distribution des orientations de fibres (<em>fiber Orientation Distribution Function</em>, fODF) lorsqu‚Äôil y a des croisements de fibres perpendiculaires. Ceci nous permet d‚Äôestimer plusieurs tenseurs √† l‚Äôint√©rieur d‚Äôun voxel et de surpasser certaines limites du tenseur de diffusion (DTI). Dans les zones √† faible anisotropie nous observons plusieurs directions, comme des petits ballons dans chaque voxel, alors que nous observons une direction principale dans les fibres les plus importantes.</p>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csa_peaks</span> <span class="o">=</span> <span class="n">peaks_from_model</span><span class="p">(</span><span class="n">csd_model</span><span class="p">,</span> <span class="n">maskdata</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">default_sphere</span><span class="p">,</span>
                             <span class="n">relative_peak_threshold</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
                             <span class="n">min_separation_angle</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                             <span class="n">mask</span><span class="o">=</span><span class="n">mask_wm</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">,</span> <span class="p">:])</span>

<span class="c1"># Initialization of LocalTracking. The computation happens in the next step.</span>
<span class="n">streamlines_generator</span> <span class="o">=</span> <span class="n">LocalTracking</span><span class="p">(</span><span class="n">csa_peaks</span><span class="p">,</span> <span class="n">stopping_criterion</span><span class="p">,</span> <span class="n">seeds</span><span class="p">,</span>
                                      <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">max_cross</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># Generate streamlines object</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">Streamlines</span><span class="p">(</span><span class="n">streamlines_generator</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">dipy.viz</span> <span class="kn">import</span> <span class="n">colormap</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">line_colors</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>
<span class="n">streamlines_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">streamlines</span><span class="p">,</span>
                               <span class="n">colormap</span><span class="o">.</span><span class="n">line_colors</span><span class="p">(</span><span class="n">streamlines</span><span class="p">))</span>

<span class="c1"># Create the 3D display.</span>
<span class="n">scene</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">streamlines_actor</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fodf_spheres</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">14.87946710578175</span><span class="p">,</span> <span class="mf">25.770232149765413</span><span class="p">,</span> <span class="mf">173.54578028650144</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">33.43851200470716</span><span class="p">,</span> <span class="mf">40.67356830562871</span><span class="p">,</span> <span class="mf">15.545914873824975</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.003256400517440014</span><span class="p">,</span> <span class="mf">0.9955397521536979</span><span class="p">,</span> <span class="mf">0.09428678453221151</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;fibers-slice.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">6.398539759431944</span><span class="p">,</span> <span class="mf">36.122368120824724</span><span class="p">,</span> <span class="mf">21.074961978614017</span><span class="p">),</span>
                 <span class="n">focal_point</span><span class="o">=</span><span class="p">(</span><span class="mf">17.02336666201742</span><span class="p">,</span> <span class="mf">55.39317316617157</span><span class="p">,</span> <span class="mf">7.230217513090364</span><span class="p">),</span>
                 <span class="n">view_up</span><span class="o">=</span><span class="p">(</span><span class="mf">0.10205867972271891</span><span class="p">,</span> <span class="mf">0.5426923506538308</span><span class="p">,</span> <span class="mf">0.8337080055001721</span><span class="p">))</span>
<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">n_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s1">&#39;fibers-zoom.png&#39;</span><span class="p">,</span>
              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">reset_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Make figure</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                        <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xticks&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;yticks&#39;</span><span class="p">:</span> <span class="p">[]})</span>
<span class="n">fig1</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;fibers-slice.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;antialiased&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;full slice&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;fibers-zoom.png&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;antialiased&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">)</span>

<span class="c1"># Glue the figure</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;fodf-tracts-fig&quot;</span><span class="p">,</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="fodf-tracts-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/irm_diffusion_16_0.png" src="_images/irm_diffusion_16_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 72 </span><span class="caption-text">Fibres reconstruites par une approche streamline d√©terministe avec une approche multi-tenseurs, qui permet de suivre plusieurs pics de diffusion √† chaque voxel, √† partir de l‚Äôensemble des points dans la mati√®re blanche sur une coupe axiale (gauche) et zoom sur une portion de la coupe (droite). Cette approche permet d‚Äô√™tre plus robuste √† la pr√©sence de croisement de fibres. Figure g√©n√©r√©e par du code python adapt√© d‚Äôun <a class="reference external" href="https://dipy.org/documentation/1.4.1./examples_built/tracking_introduction_eudx/#example-tracking-introduction-eudx">tutoriel Dipy</a> par P. Bellec sous licence <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#fodf-tracts-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>La capacit√© de fODF de repr√©senter plusieurs tenseurs √† chaque voxel permet de reconstruire des fibres qui se croisent, comme il est apparent dans le zoom de la <a class="reference internal" href="#fodf-tracts-fig"><span class="std std-numref">Fig. 72</span></a>. Il est important de r√©aliser que les donn√©es utilis√©es pour g√©n√©rer <a class="reference internal" href="#fibers-fig"><span class="std std-numref">Fig. 68</span></a> et <a class="reference internal" href="#fodf-tracts-fig"><span class="std std-numref">Fig. 72</span></a> sont les m√™mes, mais les fibres reconstruites sont tr√®s diff√©rentes! Les param√®tres que l‚Äôon choisit pour la m√©thode de reconstruction vont aussi changer la forme et le nombre de fibres. La tractographie en IRMd n‚Äôest donc pas une science exacte, et les faux positifs (une fibre reconstruite qui n‚Äôexiste pas vraiment) ainsi que les faux n√©gatifs (une fibre que l‚Äôon ne reconstruit pas mais qui existe pourtant) sont tr√®s courants.</p>
</div>
<div class="section" id="faisceaux-de-fibres">
<h3>Faisceaux de fibres<a class="headerlink" href="#faisceaux-de-fibres" title="Permalink to this headline">¬∂</a></h3>
<div class="figure align-default" id="faisceaux-fig">
<a class="reference internal image-reference" href="_images/faisceaux.png"><img alt="_images/faisceaux.png" src="_images/faisceaux.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-number">Fig. 73 </span><span class="caption-text">Illustration de trois faisceaux de fibres: les radiations optiques (OR), le faisceau arqu√©e (AF) et le faisceau occipital vertical (VOF). Les faisceaux sont pr√©sent√©s sur diff√©rentes vues d‚Äôune dissection (A, B, D), ainsi qu‚Äô√† l‚Äôaide d‚Äôune dissection virtuelle (C). Figure tir√©es de <span id="id2">[<a class="reference internal" href="#id34">JHY+20</a>]</span>, sous licence CC-BY 4.0.</span><a class="headerlink" href="#faisceaux-fig" title="Permalink to this image">¬∂</a></p>
</div>
<p>Nous pouvons fournir aux algorithmes de tractographie des a priori sur les fibres dans le cerveau que nous connaissons √† partir des √©tudes de dissection. Dans une <strong>reconstruction syst√©matique</strong> des fibres, tout va √™tre trac√©, alors que dans une <strong>dissection virtuelle</strong>, seuls certains paquets de fibres vont √™tre s√©lectionn√©s. Ces a priori permettent de limiter les faux positifs, et l‚Äôutilisation d‚Äôalgorithmes de tractographie performants permet de limiter les faux n√©gatifs. Il existe un certain nombre de faisceaux de fibres classiques avec des sch√©mas de dissection bien √©tablis, comme le corps calleux, le faisceau arqu√©, ou bien le fascicule longitudinale sup√©rieur.</p>
<p>Il est possible de calculer la valeur moyenne de l‚Äôanisotropie fractionnelle, ou tout autre m√©trique, le long d‚Äôune fibre, et ensuite de comparer cette valeur moyenne entre diff√©rents individus pour faire des tests statistiques. Dans ce cas, le recalage entre individus se fait via l‚Äôidentification de faisceaux de fibres, plut√¥t que par une m√©thode de d√©formation non-lin√©aire.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¬∂</a></h2>
<p>Dans ce cours, nous avons vu les principes de l‚ÄôIRM de diffusion. Plus pr√©cis√©ment, nous avons vu:</p>
<ul class="simple">
<li><p>Comment obtenir des images en IRMd gr√¢ce √† la diffusion de l‚Äôeau dans diff√©rentes directions</p></li>
<li><p>Comment estimer le processus de diffusion √† l‚Äôaide de tenseurs et d‚Äôen mesurer diff√©rentes m√©triques (diffusivit√© moyenne, anisotropie fractionnelle)</p></li>
<li><p>Le principe des m√©thodes de tractographie.</p></li>
<li><p>Comment estimer les croisements de fibres.</p></li>
<li><p>Comment l‚ÄôIRMd peut √™tre utilis√©e pour effectuer une dissection virtuelle.</p></li>
</ul>
</div>
<div class="section" id="references">
<h2>R√©f√©rences<a class="headerlink" href="#references" title="Permalink to this headline">¬∂</a></h2>
<p id="id3"><dl class="citation">
<dt class="label" id="id33"><span class="brackets"><a class="fn-backref" href="#id1">BFH+20</a></span></dt>
<dd><p>Mudathir Bakhit, Masazumi Fujii, Ryo Hiruta, Masayuki Yamada, Kenichiro Iwami, Taku Sato, and Kiyoshi Saito. The superior frontal longitudinal tract: a connection between the dorsal premotor and the dorsolateral prefrontal cortices. <em>Sci. Rep.</em>, 10(1):15855, September 2020.</p>
</dd>
<dt class="label" id="id34"><span class="brackets"><a class="fn-backref" href="#id2">JHY+20</a></span></dt>
<dd><p>Tatsuya Jitsuishi, Seiichiro Hirono, Tatsuya Yamamoto, Keiko Kitajo, Yasuo Iwadate, and Atsushi Yamaguchi. White matter dissection and structural connectivity of the human vertical occipital fasciculus to link vision-associated brain cortex. <em>Sci. Rep.</em>, 10(1):820, January 2020.</p>
</dd>
</dl>
</p>
</div>
<div class="section" id="exercices">
<h2>Exercices<a class="headerlink" href="#exercices" title="Permalink to this headline">¬∂</a></h2>
<div class="note admonition">
<p class="admonition-title">Exercice 6.1</p>
<p>L‚ÄôIRM de diffusion permettent de mesurer‚Ä¶ (vrai/faux, expliquez vos r√©ponses)</p>
<ol class="simple">
<li><p>Une image avec un tenseur √† chaque voxel.</p></li>
<li><p>Une image avec un ou plusieurs tenseurs √† chaque voxel.</p></li>
<li><p>Une s√©rie d‚Äôimages sensibles √† la diffusion de l‚Äôeau dans diff√©rentes directions.</p></li>
<li><p>Des images o√π l‚Äôon voit les fibres de mati√®re blanche du cerveau en 3D.</p></li>
</ol>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 6.2</p>
<p>Donnez un exemple de r√©gion avec‚Ä¶</p>
<ol class="simple">
<li><p>Une faible anisotropie fractionnelle, avec une forte diffusivit√© moyenne?</p></li>
<li><p>Une forte anisotropie fractionnelle, avec une faible diffusivit√© moyenne?</p></li>
<li><p>Une faible anisotropie fractionnelle, avec une faible diffusivit√© moyenne?</p></li>
</ol>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 6.3</p>
<p>On observe un voxel dont l‚Äôanisotropie fractionnelle est basse. Donnez deux interpr√©tations de cette observation.</p>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 6.4</p>
<p>Citez trois exemples de faisceaux de fibres.</p>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 6.5</p>
<p>Citez deux exemples de probl√®mes qui peuvent faire √©chouer un processus de tractographie ‚Äústreamline‚Äù d√©terministe.</p>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 6.6</p>
<p>Quel est l‚Äôavantage de r√©aliser des statistiques du groupe sur un faisceau de fibres, plut√¥t que voxel par voxel avec un recalage anatomique traditionnel, comme en IRMf?</p>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 6.7</p>
<p>Pour r√©pondre aux questions de cet exercice, lisez d‚Äôabord l‚Äôarticle <em>Quantification of apparent axon density and orientation dispersion in the white matter of youth born with congenital heart disease</em> de Easson et collaborateurs (publi√© en 2020 dans la revue <em>Neuroimage</em>, volume 205, ID 116255).
Celui-ci est disponible en libre acc√®s √† cette <a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2019.116255">adresse</a>.
Les questions suivantes requi√®rent des r√©ponses √† d√©veloppement court.</p>
<ul class="simple">
<li><p>Quel type de participants a √©t√© recrut√© dans cette √©tude?</p></li>
<li><p>Quel est l‚Äôobjectif principal de l‚Äô√©tude?</p></li>
<li><p>Quels sont les crit√®res d‚Äôinclusion et d‚Äôexclusion?</p></li>
<li><p>Quelle technique de neuroimagerie est utilis√©e? S‚Äôagit-il d‚Äôune technique structurelle ou fonctionnelle?</p></li>
<li><p>Quelle type de s√©quence d‚Äôacquisition d‚Äôimage est utilis√©? Listez les param√®tres.</p></li>
<li><p>Quelles types d‚Äôanalyses ont √©t√© appliqu√©s?</p></li>
<li><p>Quelle figure (ou tableau) r√©pond √† l‚Äôobjectif principal de l‚Äô√©tude?</p></li>
<li><p>Quel est le r√©sultat principal de l‚Äô√©tude?</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="connectivite.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Connectivit√© fonctionnelle</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="tep.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Tomographie par √©mission de positrons</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Pierre Bellec et l'√©quipe PSY3018<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>